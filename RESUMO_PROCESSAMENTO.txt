â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                    RESUMO: ORDEM DE LEITURA E PROCESSAMENTO
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“‹ SEQUÃŠNCIA DE PROCESSAMENTO:

1. SETTLEMENT PROCESSOR    (LÃª arquivos de vendas/settlement)
   â†“
2. RELEASES PROCESSOR      (LÃª arquivos de recebimento)
   â†“
3. MOVEMENTS PROCESSOR     (Processa movimentaÃ§Ãµes internas)
   â†“
4. RECONCILIADOR          (Faz match settlement vs recebimento)
   â†“
5. CASHFLOW CALCULATOR    (Calcula fluxo de caixa)


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ¯ O QUE CADA UM FAZ:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1ï¸âƒ£  SETTLEMENT PROCESSOR                                                                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                                                     â”‚
â”‚ Arquivo: data/settlement/*.xlsx (11 arquivos, 10.266 transaÃ§Ãµes)                                                  â”‚
â”‚                                                                                                                     â”‚
â”‚ LÃª:                                                                                                                 â”‚
â”‚ â”œâ”€ SETTLEMENT = pedido aprovado pela Mercado Pago                                                                  â”‚
â”‚ â”œâ”€ INSTALLMENT = parcelas individuais                                                                              â”‚
â”‚ â”œâ”€ REFUND = estorno/devoluÃ§Ã£o                                                                                      â”‚
â”‚ â””â”€ CHARGEBACK = disputa de cliente                                                                                 â”‚
â”‚                                                                                                                     â”‚
â”‚ Cria:                                                                                                               â”‚
â”‚ â”œâ”€ installments (7.690 items) = parcelas com valores originais                                                     â”‚
â”‚ â”‚  â””â”€ installment_net_amount_original = valor original (NUNCA MUDA!)                                              â”‚
â”‚ â”‚  â””â”€ installment_net_amount = cÃ³pia do original (serÃ¡ ajustada depois)                                           â”‚
â”‚ â”‚  â””â”€ refund_applied = 0 inicialmente (serÃ¡ calculado depois!)                                                    â”‚
â”‚ â”‚  â””â”€ status = 'pending' (serÃ¡ atualizado no reconciliador)                                                       â”‚
â”‚ â”‚                                                                                                                   â”‚
â”‚ â””â”€ order_balances (2.290 items) = resumo por pedido                                                               â”‚
â”‚    â””â”€ refunded = total de refund                                                                                  â”‚
â”‚    â””â”€ refund_date = quando foi refundado                                                                          â”‚
â”‚    â””â”€ total_net = quanto deveria receber                                                                          â”‚
â”‚                                                                                                                     â”‚
â”‚ âš ï¸  IMPORTANTE:                                                                                                    â”‚
â”‚    â”œâ”€ Refunds NÃƒO sÃ£o aplicados em parcelados aqui                                                                â”‚
â”‚    â”œâ”€ Apenas em pagamentos Ã  vista (single installment)                                                            â”‚
â”‚    â””â”€ Parcelados esperam pelo reconciliador                                                                       â”‚
â”‚                                                                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2ï¸âƒ£  RELEASES PROCESSOR                                                                                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                                                     â”‚
â”‚ Arquivo: data/recebimentos/*.xlsx (11 arquivos, 6.098 releases)                                                   â”‚
â”‚                                                                                                                     â”‚
â”‚ LÃª: Quando o dinheiro foi de fato recebido/liberado                                                               â”‚
â”‚                                                                                                                     â”‚
â”‚ Separa em 2 categorias:                                                                                             â”‚
â”‚                                                                                                                     â”‚
â”‚ A) PAYMENTS (5.407 items) = transaÃ§Ãµes que geram receivables                                                       â”‚
â”‚    â”œâ”€ description = 'payment'                                                                                      â”‚
â”‚    â”œâ”€ description = 'release'                                                                                      â”‚
â”‚    â”œâ”€ description = 'credit_card', 'pix', 'boleto', etc.                                                          â”‚
â”‚    â””â”€ record_type = 'SETTLEMENT'                                                                                   â”‚
â”‚                                                                                                                     â”‚
â”‚    Cada payment tem:                                                                                                â”‚
â”‚    â”œâ”€ release_date = QUANDO RECEBEU (use isso para match!)                                                         â”‚
â”‚    â”œâ”€ approval_date = quando foi aprovado                                                                          â”‚
â”‚    â”œâ”€ external_reference = link com pedido/installment                                                             â”‚
â”‚    â””â”€ net_credit_amount = quanto entrou                                                                            â”‚
â”‚                                                                                                                     â”‚
â”‚ B) MOVEMENTS (691 items) = operaÃ§Ãµes internas (nÃ£o geram receivables)                                              â”‚
â”‚    â”œâ”€ description = 'refund' (estorno)                                                                             â”‚
â”‚    â”œâ”€ description = 'chargeback'                                                                                   â”‚
â”‚    â”œâ”€ description = 'payout' (saque)                                                                               â”‚
â”‚    â””â”€ description = 'reserve_...' (reservas)                                                                       â”‚
â”‚                                                                                                                     â”‚
â”‚ â­ CRITICAL:                                                                                                        â”‚
â”‚    â””â”€ Use release_date para match, nÃ£o approval_date!                                                              â”‚
â”‚       release_date = quando dinheiro chegou na conta (para reconciliaÃ§Ã£o)                                           â”‚
â”‚       approval_date = quando foi autorizado (informativo)                                                           â”‚
â”‚                                                                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3ï¸âƒ£  MOVEMENTS PROCESSOR                                                                                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                                                     â”‚
â”‚ Processa: movements (691 items)                                                                                     â”‚
â”‚                                                                                                                     â”‚
â”‚ âš ï¸  NÃƒO impacta as parcelas, apenas informativo!                                                                   â”‚
â”‚                                                                                                                     â”‚
â”‚ AnÃ¡lise de:                                                                                                         â”‚
â”‚ â”œâ”€ Chargebacks (disputas)                                                                                          â”‚
â”‚ â”œâ”€ Payouts (saques)                                                                                                â”‚
â”‚ â”œâ”€ Reservas                                                                                                         â”‚
â”‚ â””â”€ Taxas especiais                                                                                                  â”‚
â”‚                                                                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4ï¸âƒ£  RECONCILIADOR V3 (5 PASSOS)                                                                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                                                     â”‚
â”‚ PASSO 1: Calcular Saldos                                                                                           â”‚
â”‚ â”œâ”€ Para cada pedido:                                                                                               â”‚
â”‚ â”‚  â”œâ”€ Saldo Esperado = sum(installment original amounts)                                                          â”‚
â”‚ â”‚  â”œâ”€ Saldo Recebido = sum(payment amounts)                                                                       â”‚
â”‚ â”‚  â””â”€ DiferenÃ§a = quanto falta ou sobra                                                                            â”‚
â”‚ â”‚                                                                                                                   â”‚
â”‚ PASSO 2: Reconciliar por Saldo                                                                                     â”‚
â”‚ â”œâ”€ Para cada pedido:                                                                                               â”‚
â”‚ â”‚  â”œâ”€ Ordenar parcelas por vencimento (money_release_date)                                                        â”‚
â”‚ â”‚  â”œâ”€ Ordenar payments por quando recebeu (release_date)                                                          â”‚
â”‚ â”‚  â”œâ”€ Fazer match: payment 1 â†’ parcela 1, etc.                                                                    â”‚
â”‚ â”‚  â””â”€ Atualizar status de cada parcela:                                                                            â”‚
â”‚ â”‚     â”œâ”€ received = recebeu na data esperada                                                                       â”‚
â”‚ â”‚     â”œâ”€ received_advance = recebeu ANTES do vencimento                                                            â”‚
â”‚ â”‚     â”œâ”€ overdue = venceu mas nÃ£o recebeu ainda                                                                    â”‚
â”‚ â”‚     â””â”€ pending = nÃ£o recebeu nada                                                                                â”‚
â”‚ â”‚                                                                                                                   â”‚
â”‚ PASSO 3: Aplicar Refunds com AnÃ¡lise de Data                                                                       â”‚
â”‚ â”œâ”€ Para cada pedido com refund:                                                                                    â”‚
â”‚ â”‚  â”œâ”€ Extrair: refund_date (quando refund foi aprovado)                                                            â”‚
â”‚ â”‚  â”œâ”€ Extrair: first_payment_date (quando chegou primeiro payment)                                                â”‚
â”‚ â”‚  â”‚                                                                                                               â”‚
â”‚ â”‚  â”œâ”€ COMPARAÃ‡ÃƒO (use <=, nÃ£o <):                                                                                 â”‚
â”‚ â”‚  â”‚  if refund_date <= first_payment_date:                                                                       â”‚
â”‚ â”‚  â”‚      "Refund foi ANTES ou IGUAL ao primeiro payment"                                                         â”‚
â”‚ â”‚  â”‚      â†’ Distribuir em TODAS as parcelas                                                                       â”‚
â”‚ â”‚  â”‚  else:                                                                                                        â”‚
â”‚ â”‚  â”‚      "Refund foi DEPOIS dos pagamentos"                                                                      â”‚
â”‚ â”‚  â”‚      â†’ Distribuir APENAS em parcelas nÃ£o recebidas                                                           â”‚
â”‚ â”‚  â”‚                                                                                                               â”‚
â”‚ â”‚  â””â”€ Para cada parcela afetada:                                                                                  â”‚
â”‚ â”‚     â”œâ”€ refund_per_parcel = total_refund / num_parcelas                                                         â”‚
â”‚ â”‚     â”œâ”€ new_amount = original_amount - refund_per_parcel                                                         â”‚
â”‚ â”‚     â”œâ”€ if new_amount <= 0:                                                                                      â”‚
â”‚ â”‚     â”‚  â””â”€ Marcar is_cancelled = True                                                                            â”‚
â”‚ â”‚     â””â”€ refund_applied = refund_per_parcel (A FRAÃ‡ÃƒO, nÃ£o total!)                                                â”‚
â”‚ â”‚                                                                                                                   â”‚
â”‚ PASSO 4: Garantir Status Correto de Canceladas                                                                     â”‚
â”‚ â”œâ”€ Para cada parcela com is_cancelled = True:                                                                      â”‚
â”‚ â”‚  â””â”€ ForÃ§ar status = 'cancelled' (pode ter sido overdue/pending antes)                                            â”‚
â”‚ â”‚                                                                                                                   â”‚
â”‚ PASSO 5: Gerar EstatÃ­sticas                                                                                        â”‚
â”‚ â””â”€ Contar e exibir:                                                                                                â”‚
â”‚    â”œâ”€ Pedidos fechados (100% recebido)                                                                             â”‚
â”‚    â”œâ”€ Pedidos abertos (parcialmente)                                                                               â”‚
â”‚    â”œâ”€ Parcelas por status (received, pending, overdue, cancelled, etc.)                                            â”‚
â”‚    â””â”€ Total processado                                                                                              â”‚
â”‚                                                                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5ï¸âƒ£  CASHFLOW CALCULATOR                                                                                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                                                     â”‚
â”‚ Usa: installments com status final                                                                                â”‚
â”‚                                                                                                                     â”‚
â”‚ Calcula:                                                                                                            â”‚
â”‚ â”œâ”€ Quando cada parcela libera dinheiro (money_release_date)                                                       â”‚
â”‚ â”œâ”€ Quanto estava liberado em cada dia                                                                              â”‚
â”‚ â””â”€ ProjeÃ§Ãµes futuras                                                                                               â”‚
â”‚                                                                                                                     â”‚
â”‚ Resultado: AnÃ¡lise de cash flow                                                                                    â”‚
â”‚                                                                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“Š RESULTADO FINAL (EXEMPLO REAL):

Input:
â”œâ”€ Settlement: 10.266 transaÃ§Ãµes â†’ 2.290 pedidos â†’ 7.690 parcelas
â””â”€ Recebimentos: 6.098 releases â†’ 5.407 payments + 691 movements

Output (installments):
â”œâ”€ received: 2.785           (recebeu na data esperada)
â”œâ”€ received_advance: 2.340   (recebeu antes do vencimento!)
â”œâ”€ pending: 2.458            (nÃ£o recebeu ainda)
â”œâ”€ overdue: 12               (venceu e ainda nÃ£o recebeu)
â””â”€ cancelled: 95             (refundadas ou fully charged back)

Summary:
â”œâ”€ Pedidos fechados: 1.183   (recebeu 100% do esperado)
â””â”€ Pedidos abertos: 1.053    (recebeu parcialmente)


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âš ï¸  ERROS CRÃTICOS COMUNS:

1. âŒ "Parcela 4/4 estÃ¡ cancelada, mas deveria estar pendente"
   â”œâ”€ CAUSA: Refund distribuÃ­do para not-received apenas
   â”œâ”€ PROBLEMA: refund_date == first_payment_date, mas usa <
   â””â”€ SOLUÃ‡ÃƒO: Usar <= em vez de < (reconciliator.py:744)

2. âŒ "Status muda entre runs"
   â”œâ”€ CAUSA: _ensure_cancelled_status() nÃ£o estÃ¡ sincronizando
   â””â”€ SOLUÃ‡ÃƒO: Confirmar que Ã© chamado (reconciliator.py:117)

3. âŒ "Refund_applied mostra valor errado"
   â”œâ”€ CAUSA: Atribuindo total_refund em vez de refund_per_parcel
   â””â”€ SOLUÃ‡ÃƒO: Verificar _apply_adjustment_to_installment (linha 793)

4. âŒ "Payments nÃ£o fazem match com parcelas"
   â”œâ”€ CAUSA: external_reference com espaÃ§os ou maiÃºsculas diferentes
   â””â”€ SOLUÃ‡ÃƒO: Adicionar .strip().lower() ao comparar

5. âŒ "Datas em formato errado dÃ£o TypeError"
   â”œâ”€ CAUSA: Misturar string com datetime.date
   â””â”€ SOLUÃ‡ÃƒO: Sempre converter com _parse_date_safe() (linhas 738-740)


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“š DOCUMENTAÃ‡ÃƒO COMPLETA:

â”œâ”€ FLUXO_LEITURA_PROCESSAMENTO.md (2000+ linhas)
â”‚  â””â”€ ExplicaÃ§Ã£o detalhada de CADA etapa com exemplos de dados

â””â”€ DIAGRAMA_FLUXO.txt
   â””â”€ Diagrama ASCII visual do fluxo


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
