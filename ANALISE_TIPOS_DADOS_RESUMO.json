{
  "payment_methods": {
    "master": {
      "count": 679,
      "percentage": 51.48,
      "description": "Cartão de Crédito Mastercard - Pagamento via cartão de crédito",
      "category": "CARTÃO DE CRÉDITO",
      "affects_reconciliation": true,
      "include_in_reconciliation": true,
      "notes": "Afeta taxas (média 3.5%) e prazos de liberação. Sempre tem parcelas.",
      "example": {
        "RELEASE_DATE": "2025-11-01T07:26:43.000-03:00",
        "RECORD_TYPE": "release",
        "DESCRIPTION": "payment",
        "GROSS_AMOUNT": "353.87",
        "MP_FEE_AMOUNT": "-12.35",
        "NET_CREDIT_AMOUNT": "341.52",
        "INSTALLMENTS": "2/3",
        "PAYMENT_METHOD": "master"
      }
    },
    "visa": {
      "count": 474,
      "percentage": 35.94,
      "description": "Cartão de Crédito Visa - Pagamento via cartão de crédito",
      "category": "CARTÃO DE CRÉDITO",
      "affects_reconciliation": true,
      "include_in_reconciliation": true,
      "notes": "Afeta taxas (média 3.5%) e prazos de liberação. Sempre tem parcelas.",
      "example": {
        "RELEASE_DATE": "2025-11-01T03:01:40.000-03:00",
        "RECORD_TYPE": "release",
        "DESCRIPTION": "payment",
        "GROSS_AMOUNT": "170.30",
        "MP_FEE_AMOUNT": "-11.49",
        "NET_CREDIT_AMOUNT": "158.81",
        "INSTALLMENTS": "4/6",
        "PAYMENT_METHOD": "visa"
      }
    },
    "available_money": {
      "count": 112,
      "percentage": 8.49,
      "description": "Saldo Disponível - Transferências de saldo para conta bancária (SAQUES)",
      "category": "TRANSFERÊNCIA BANCÁRIA",
      "affects_reconciliation": false,
      "include_in_reconciliation": false,
      "notes": "NÃO É UMA VENDA! É apenas transferência de saldo. EXCLUIR da conciliação de vendas.",
      "example": {
        "RELEASE_DATE": "2025-11-03T10:57:09.000-03:00",
        "RECORD_TYPE": "release",
        "DESCRIPTION": "reserve_for_payout",
        "NET_DEBIT_AMOUNT": "8031.00",
        "GROSS_AMOUNT": "-8031.00",
        "MP_FEE_AMOUNT": "0.00",
        "PAYMENT_METHOD": "available_money"
      }
    },
    "elo": {
      "count": 31,
      "percentage": 2.35,
      "description": "Cartão de Crédito Elo - Pagamento via cartão de crédito",
      "category": "CARTÃO DE CRÉDITO",
      "affects_reconciliation": true,
      "include_in_reconciliation": true,
      "notes": "Afeta taxas (média 3.5%) e prazos de liberação. Sempre tem parcelas.",
      "example": {
        "RELEASE_DATE": "2025-11-01T00:37:45.000-03:00",
        "RECORD_TYPE": "release",
        "DESCRIPTION": "payment",
        "GROSS_AMOUNT": "147.96",
        "MP_FEE_AMOUNT": "-9.98",
        "NET_CREDIT_AMOUNT": "137.98",
        "INSTALLMENTS": "4/5",
        "PAYMENT_METHOD": "elo"
      }
    },
    "amex": {
      "count": 21,
      "percentage": 1.59,
      "description": "Cartão de Crédito American Express - Pagamento via cartão de crédito",
      "category": "CARTÃO DE CRÉDITO",
      "affects_reconciliation": true,
      "include_in_reconciliation": true,
      "notes": "Afeta taxas (média 4%) e prazos de liberação. Sempre tem parcelas.",
      "example": {
        "RELEASE_DATE": "2025-11-03T14:58:02.000-03:00",
        "RECORD_TYPE": "release",
        "DESCRIPTION": "payment",
        "GROSS_AMOUNT": "125.20",
        "MP_FEE_AMOUNT": "-8.44",
        "NET_CREDIT_AMOUNT": "116.76",
        "INSTALLMENTS": "6/6",
        "PAYMENT_METHOD": "amex"
      }
    }
  },
  "transaction_types": {
    "SETTLEMENT": {
      "count": 381,
      "percentage": 23.20,
      "description": "Liberação de valores recebidos - registro PRINCIPAL da venda",
      "category": "SETTLEMENT",
      "affects_reconciliation": true,
      "include_in_reconciliation": true,
      "critical": "CRÍTICO - Este é o registro da venda. Usar SETTLEMENT_NET_AMOUNT.",
      "notes": "Representa a venda inicial. Para vendas parceladas, o valor total está aqui. Os INSTALLMENTs são apenas projeções futuras.",
      "example": {
        "TRANSACTION_TYPE": "SETTLEMENT",
        "PAYMENT_METHOD_TYPE": "credit_card",
        "PAYMENT_METHOD": "visa",
        "TRANSACTION_AMOUNT": "111.68",
        "FEE_AMOUNT": "-3.45",
        "SETTLEMENT_NET_AMOUNT": "108.23",
        "INSTALLMENTS": "1",
        "MONEY_RELEASE_DATE": "2025-12-01T10:53:04.697-04:00"
      }
    },
    "PAYOUTS": {
      "count": 11,
      "percentage": 0.67,
      "description": "Transferência de saldo para conta bancária (SAQUES)",
      "category": "PAYOUT",
      "affects_reconciliation": false,
      "include_in_reconciliation": false,
      "critical": "NÃO INCLUIR - Não é venda, apenas movimentação de saldo",
      "notes": "Equivalente ao 'available_money' do arquivo Recebimentos. EXCLUIR da conciliação de vendas.",
      "example": {
        "TRANSACTION_TYPE": "PAYOUTS",
        "PAYMENT_METHOD_TYPE": " ",
        "TRANSACTION_AMOUNT": "-8031.00",
        "FEE_AMOUNT": "0.00",
        "SETTLEMENT_NET_AMOUNT": "-8031.00"
      }
    },
    "REFUND": {
      "count": 6,
      "percentage": 0.37,
      "description": "Estorno de pagamento - devolução ao cliente",
      "category": "REFUND",
      "affects_reconciliation": true,
      "include_in_reconciliation": true,
      "critical": "CRÍTICO - SUBTRAIR do total de vendas",
      "notes": "Representa cancelamento/estorno. Taxa é parcialmente devolvida. Deve ser SUBTRAÍDO das vendas.",
      "example": {
        "TRANSACTION_TYPE": "REFUND",
        "PAYMENT_METHOD_TYPE": "credit_card",
        "PAYMENT_METHOD": "master",
        "TRANSACTION_AMOUNT": "-556.74",
        "FEE_AMOUNT": "19.43",
        "SETTLEMENT_NET_AMOUNT": "-537.31",
        "INSTALLMENTS": "5",
        "MONEY_RELEASE_DATE": "2025-11-04T07:28:39.000-04:00"
      }
    },
    "INSTALLMENT": {
      "count": 1244,
      "percentage": 75.76,
      "description": "Parcelas futuras de vendas parceladas - CONTROLE DE FLUXO DE CAIXA",
      "category": "INFORMATIVO",
      "affects_reconciliation": false,
      "include_in_reconciliation": false,
      "critical": "CRÍTICO - NÃO SOMAR (duplicaria valores). Apenas para controle de cronograma.",
      "notes": "Representa cada parcela futura de uma venda parcelada. O valor TOTAL já está no SETTLEMENT. Estes registros servem apenas para saber QUANDO cada parcela será liberada.",
      "example": {
        "DESCRIPTION": "INSTALLMENT",
        "TRANSACTION_TYPE": "NaN",
        "PAYMENT_METHOD_TYPE": "NaN",
        "TRANSACTION_AMOUNT": "0.00",
        "INSTALLMENT_NUMBER": "1/2",
        "INSTALLMENT_NET_AMOUNT": "119.06",
        "MONEY_RELEASE_DATE": "2025-12-01T12:19:49.511-04:00"
      }
    }
  },
  "insights": {
    "payment_methods_affect_reconciliation": true,
    "payment_methods_notes": "Os métodos de pagamento afetam as taxas e prazos. Cartões de crédito (master, visa, elo, amex) são vendas reais. O 'available_money' NÃO é venda, são apenas saques/transferências.",

    "transaction_types_affect_reconciliation": true,
    "transaction_types_notes": "SETTLEMENT representa vendas (INCLUIR), REFUND representa estornos (INCLUIR com sinal negativo), PAYOUTS são saques (EXCLUIR), INSTALLMENT são parcelas futuras (EXCLUIR - duplicaria valores).",

    "critical_discovery": {
      "title": "DESCOBERTA CRÍTICA: INSTALLMENT",
      "description": "75.76% dos registros no Settlement são INSTALLMENTs. Estes NÃO devem ser somados pois duplicariam os valores já contabilizados no SETTLEMENT.",
      "example": "Uma venda de R$ 246,73 parcelada em 2x gera 3 registros: 1 SETTLEMENT (com o valor total) + 2 INSTALLMENT (parcelas 1/2 e 2/2). Somar os 3 resultaria em R$ 485,85 (quase o dobro do correto)."
    },

    "reconciliation_rules": {
      "recebimentos_file": {
        "include": [
          "PAYMENT_METHOD IN ('master', 'visa', 'elo', 'amex')",
          "RECORD_TYPE = 'release'",
          "DESCRIPTION = 'payment'"
        ],
        "exclude": [
          "PAYMENT_METHOD = 'available_money'",
          "DESCRIPTION = 'reserve_for_payout'"
        ],
        "field_to_sum": "NET_CREDIT_AMOUNT"
      },
      "settlement_file": {
        "include": [
          "TRANSACTION_TYPE IN ('SETTLEMENT', 'REFUND')"
        ],
        "exclude": [
          "TRANSACTION_TYPE = 'PAYOUTS'",
          "DESCRIPTION = 'INSTALLMENT'",
          "TRANSACTION_TYPE IS NULL"
        ],
        "field_to_sum": "SETTLEMENT_NET_AMOUNT"
      }
    },

    "summary": {
      "total_recebimentos": 1319,
      "total_settlement": 1642,
      "recebimentos_valid_for_reconciliation": 1207,
      "recebimentos_payouts": 112,
      "settlement_valid_for_reconciliation": 387,
      "settlement_installments_to_exclude": 1244,
      "settlement_payouts_to_exclude": 11,
      "unique_payment_methods": 5,
      "unique_transaction_types": 4,
      "notes": "Settlement tem mais registros devido às parcelas individualizadas (INSTALLMENT)"
    },

    "expected_reconciliation": {
      "recebimentos_total": "SUM de 1207 registros (excluindo 112 available_money)",
      "settlement_total": "SUM de 387 registros (381 SETTLEMENT + 6 REFUND, excluindo 1244 INSTALLMENT e 11 PAYOUTS)",
      "should_match": true,
      "notes": "Os dois arquivos devem ter valores próximos. Diferenças podem ocorrer devido a datas de corte diferentes."
    }
  }
}
