C:\Users\mooui\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.11_qbz5n2kfra8p0\LocalCache\local-packages\Python311\site-packages\openpyxl\styles\stylesheet.py:237: UserWarning: Workbook contains no default style, apply openpyxl's default
  warn("Workbook contains no default style, apply openpyxl's default")
C:\Users\mooui\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.11_qbz5n2kfra8p0\LocalCache\local-packages\Python311\site-packages\openpyxl\styles\stylesheet.py:237: UserWarning: Workbook contains no default style, apply openpyxl's default
  warn("Workbook contains no default style, apply openpyxl's default")
C:\Users\mooui\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.11_qbz5n2kfra8p0\LocalCache\local-packages\Python311\site-packages\openpyxl\styles\stylesheet.py:237: UserWarning: Workbook contains no default style, apply openpyxl's default
  warn("Workbook contains no default style, apply openpyxl's default")
C:\Users\mooui\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.11_qbz5n2kfra8p0\LocalCache\local-packages\Python311\site-packages\openpyxl\styles\stylesheet.py:237: UserWarning: Workbook contains no default style, apply openpyxl's default
  warn("Workbook contains no default style, apply openpyxl's default")
C:\Users\mooui\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.11_qbz5n2kfra8p0\LocalCache\local-packages\Python311\site-packages\openpyxl\styles\stylesheet.py:237: UserWarning: Workbook contains no default style, apply openpyxl's default
  warn("Workbook contains no default style, apply openpyxl's default")
C:\Users\mooui\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.11_qbz5n2kfra8p0\LocalCache\local-packages\Python311\site-packages\openpyxl\styles\stylesheet.py:237: UserWarning: Workbook contains no default style, apply openpyxl's default
  warn("Workbook contains no default style, apply openpyxl's default")
C:\Users\mooui\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.11_qbz5n2kfra8p0\LocalCache\local-packages\Python311\site-packages\openpyxl\styles\stylesheet.py:237: UserWarning: Workbook contains no default style, apply openpyxl's default
  warn("Workbook contains no default style, apply openpyxl's default")
C:\Users\mooui\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.11_qbz5n2kfra8p0\LocalCache\local-packages\Python311\site-packages\openpyxl\styles\stylesheet.py:237: UserWarning: Workbook contains no default style, apply openpyxl's default
  warn("Workbook contains no default style, apply openpyxl's default")
C:\Users\mooui\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.11_qbz5n2kfra8p0\LocalCache\local-packages\Python311\site-packages\openpyxl\styles\stylesheet.py:237: UserWarning: Workbook contains no default style, apply openpyxl's default
  warn("Workbook contains no default style, apply openpyxl's default")
C:\Users\mooui\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.11_qbz5n2kfra8p0\LocalCache\local-packages\Python311\site-packages\openpyxl\styles\stylesheet.py:237: UserWarning: Workbook contains no default style, apply openpyxl's default
  warn("Workbook contains no default style, apply openpyxl's default")
C:\Users\mooui\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.11_qbz5n2kfra8p0\LocalCache\local-packages\Python311\site-packages\openpyxl\styles\stylesheet.py:237: UserWarning: Workbook contains no default style, apply openpyxl's default
  warn("Workbook contains no default style, apply openpyxl's default")
C:\Users\mooui\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.11_qbz5n2kfra8p0\LocalCache\local-packages\Python311\site-packages\openpyxl\styles\stylesheet.py:237: UserWarning: Workbook contains no default style, apply openpyxl's default
  warn("Workbook contains no default style, apply openpyxl's default")
C:\Users\mooui\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.11_qbz5n2kfra8p0\LocalCache\local-packages\Python311\site-packages\openpyxl\styles\stylesheet.py:237: UserWarning: Workbook contains no default style, apply openpyxl's default
  warn("Workbook contains no default style, apply openpyxl's default")
C:\Users\mooui\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.11_qbz5n2kfra8p0\LocalCache\local-packages\Python311\site-packages\openpyxl\styles\stylesheet.py:237: UserWarning: Workbook contains no default style, apply openpyxl's default
  warn("Workbook contains no default style, apply openpyxl's default")
C:\Users\mooui\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.11_qbz5n2kfra8p0\LocalCache\local-packages\Python311\site-packages\openpyxl\styles\stylesheet.py:237: UserWarning: Workbook contains no default style, apply openpyxl's default
  warn("Workbook contains no default style, apply openpyxl's default")
C:\Users\mooui\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.11_qbz5n2kfra8p0\LocalCache\local-packages\Python311\site-packages\openpyxl\styles\stylesheet.py:237: UserWarning: Workbook contains no default style, apply openpyxl's default
  warn("Workbook contains no default style, apply openpyxl's default")
C:\Users\mooui\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.11_qbz5n2kfra8p0\LocalCache\local-packages\Python311\site-packages\openpyxl\styles\stylesheet.py:237: UserWarning: Workbook contains no default style, apply openpyxl's default
  warn("Workbook contains no default style, apply openpyxl's default")
C:\Users\mooui\AppData\Local\Packages\PythonSoftwareFoundation.Python.3.11_qbz5n2kfra8p0\LocalCache\local-packages\Python311\site-packages\openpyxl\styles\stylesheet.py:237: UserWarning: Workbook contains no default style, apply openpyxl's default
  warn("Workbook contains no default style, apply openpyxl's default")

======================================================================
======================================================================
            TEST RECONCILIATION V3 - Validação de Filtragem           
======================================================================
======================================================================

======================================================================
 PROCESSANDO SETTLEMENT
======================================================================


Processando 11 arquivo(s) de settlement...
    202501s.xlsx: 60 linhas
    202502s.xlsx: 144 linhas
    202503s.xlsx: 61 linhas
    202504s.xlsx: 85 linhas
    202505s.xlsx: 1141 linhas
    202506s.xlsx: 1427 linhas
    202507s.xlsx: 2000 linhas
    202508s.xlsx: 1517 linhas
    202509s.xlsx: 2311 linhas
    202510s.xlsx: 1378 linhas
    202511s.xlsx: 1642 linhas

Processando pedidos e gerando parcelas...
    2637 pedidos processados
    8828 parcelas geradas

Processamento concluído:
   Total de transações: 11766
   Total de pedidos: 2635
   Total de parcelas: 8828

======================================================================
 PROCESSANDO RECEBIMENTOS
======================================================================


Processando 11 arquivo(s) de recebimentos...
    202501r.xlsx: 79 releases
    202502r.xlsx: 77 releases
    202503r.xlsx: 87 releases
    202504r.xlsx: 83 releases
    202505r.xlsx: 82 releases
    202506r.xlsx: 328 releases
    202507r.xlsx: 1153 releases
    202508r.xlsx: 964 releases
    202509r.xlsx: 1117 releases
    202510r.xlsx: 1678 releases
    202511r.xlsx: 1319 releases
        Descrição desconhecida: nan (payment_method: nan, record_type: initial_available_balance)
        Descrição desconhecida: nan (payment_method: nan, record_type: total)
        Descrição desconhecida: nan (payment_method: nan, record_type: initial_available_balance)
        Descrição desconhecida: nan (payment_method: nan, record_type: total)
        Descrição desconhecida: nan (payment_method: nan, record_type: initial_available_balance)
        Descrição desconhecida: nan (payment_method: nan, record_type: total)
        Descrição desconhecida: nan (payment_method: nan, record_type: initial_available_balance)
        Descrição desconhecida: nan (payment_method: nan, record_type: total)
        Descrição desconhecida: nan (payment_method: nan, record_type: initial_available_balance)
        Descrição desconhecida: nan (payment_method: nan, record_type: total)
        Descrição desconhecida: nan (payment_method: nan, record_type: initial_available_balance)
        Descrição desconhecida: nan (payment_method: nan, record_type: total)
        Descrição desconhecida: nan (payment_method: nan, record_type: initial_available_balance)
        Descrição desconhecida: nan (payment_method: nan, record_type: total)
        Descrição desconhecida: nan (payment_method: nan, record_type: initial_available_balance)
        Descrição desconhecida: nan (payment_method: nan, record_type: total)
        Descrição desconhecida: nan (payment_method: nan, record_type: initial_available_balance)
        Descrição desconhecida: nan (payment_method: nan, record_type: total)
        Descrição desconhecida: nan (payment_method: nan, record_type: initial_available_balance)
        Descrição desconhecida: nan (payment_method: nan, record_type: total)
        Descrição desconhecida: nan (payment_method: nan, record_type: initial_available_balance)
        Descrição desconhecida: nan (payment_method: nan, record_type: total)

 Resumo do processamento:
   Total de releases: 6967
   Payments (vendas): 6164
   Movimentações: 803

======================================================================
 ANÁLISE DE PAYMENT METHODS (Recebimentos)
======================================================================

Método               Contagem     % Total      Valor Total     Ação      
----------------------------------------------------------------------
master               3524               50.6%      974328.80 INCLUI    
visa                 2467               35.4%      709137.88 INCLUI    
available_money      702                10.1%     1963582.71 EXCLUI    
elo                  145                 2.1%       38520.25 INCLUI    
amex                 87                  1.2%       24485.70 INCLUI    
nan                  22                  0.3%       60227.23 EXCLUI    
bolbradesco          12                  0.2%       16298.68 EXCLUI    
pix                  6                   0.1%        2937.15 EXCLUI    
consumer_credits     2                   0.0%        1148.88 EXCLUI    
----------------------------------------------------------------------
TOTAL VÁLIDO         6223               89.3%     1746472.63
TOTAL INVÁLIDO       744                10.7%

======================================================================
 ANÁLISE DE TRANSACTION TYPES (Settlement)
======================================================================

Tipo de Transação              Contagem     % Total      Valor Total     Ação      
--------------------------------------------------------------------------------
nan (INSTALLMENT)              8885               75.5%           0.00 EXCLUI    
SETTLEMENT (nan)               2668               22.7%     2491153.51 INCLUI    
PAYOUTS (nan)                  107                 0.9%    -1722460.08 EXCLUI    
REFUND (nan)                   102                 0.9%      -38570.42 INCLUI    
CHARGEBACK (nan)               3                   0.0%       -5014.96 EXCLUI    
CHARGEBACK_CANCEL (nan)        1                   0.0%        3838.70 EXCLUI    
--------------------------------------------------------------------------------
TOTAL VÁLIDO                   2770               23.5%     2452583.09
TOTAL INVÁLIDO                 8996               76.5%

======================================================================
 ANÁLISE DE CORRESPONDÊNCIA (Settlement × Releases)
======================================================================

External References no Settlement: 2635
External References nos Payments: 2312
Correspondências (ambos): 2244 (85.2%)
Payments órfãos (só em Payments): 68 (2.9%)
Settlement sem Payment: 391 (14.8%)

Motivos normais para não bater 100%:
  • Settlement projeta FUTURO (Dec 2025, Jan 2026)
  • Recebimentos registram PASSADO (até Nov 2025)
  • Antecipações: parcelas recebidas antes da data esperada
  • Timing: 1-2 dias de diferença no processamento

======================================================================
 TESTE DO JSON CACHE
======================================================================

Traceback (most recent call last):
  File "C:\projetos_code\conciliacao_mercado_pago_ecommerce\backend\utils\json_cache.py", line 62, in save_settlement
    print(f"\u2705 Settlement salvo em {file_path}")
  File "C:\Program Files\WindowsApps\PythonSoftwareFoundation.Python.3.11_3.11.2544.0_x64__qbz5n2kfra8p0\Lib\encodings\cp1252.py", line 19, in encode
    return codecs.charmap_encode(input,self.errors,encoding_table)[0]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
UnicodeEncodeError: 'charmap' codec can't encode character '\u2705' in position 0: character maps to <undefined>

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\projetos_code\conciliacao_mercado_pago_ecommerce\test_reconciliation_v3.py", line 247, in <module>
    main()
  File "C:\projetos_code\conciliacao_mercado_pago_ecommerce\test_reconciliation_v3.py", line 218, in main
    test_json_cache()
  File "C:\projetos_code\conciliacao_mercado_pago_ecommerce\test_reconciliation_v3.py", line 162, in test_json_cache
    cache.save_settlement(test_settlement)
  File "C:\projetos_code\conciliacao_mercado_pago_ecommerce\backend\utils\json_cache.py", line 65, in save_settlement
    print(f"\u274c Erro ao salvar Settlement: {e}")
  File "C:\Program Files\WindowsApps\PythonSoftwareFoundation.Python.3.11_3.11.2544.0_x64__qbz5n2kfra8p0\Lib\encodings\cp1252.py", line 19, in encode
    return codecs.charmap_encode(input,self.errors,encoding_table)[0]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
UnicodeEncodeError: 'charmap' codec can't encode character '\u274c' in position 0: character maps to <undefined>
